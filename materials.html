<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ú–∞—Ç–µ—Ä–∏–∞–ª—ã - –ö–æ–≤—à–µ–π-–°–µ—Ä–≤–∏—Å</title>
    <link rel="stylesheet" href="styles.css">
    <style>

        .search-bar {
            display: flex;
            gap: 15px;
            margin-bottom: 30px;
        }

        .search-bar input {
            flex: 1;
            padding: 12px 20px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 1em;
        }

        .search-bar button {
            padding: 12px 30px;
            background: #3498db;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1em;
        }

        .materials-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 25px;
            margin-bottom: 40px;
        }

        .material-card {
            background: white;
            border: 1px solid #e9ecef;
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 3px 15px rgba(0,0,0,0.1);
            transition: transform 0.3s;
        }

        .material-card:hover {
            transform: translateY(-5px);
        }

        .material-header {
            display: flex;
            justify-content: between;
            align-items: start;
            margin-bottom: 15px;
        }

        .material-name {
            font-size: 1.3em;
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 5px;
        }

        .material-category {
            background: #e74c3c;
            color: white;
            padding: 4px 12px;
            border-radius: 15px;
            font-size: 0.8em;
        }

        .material-details {
            margin-bottom: 20px;
        }

        .material-details p {
            margin: 8px 0;
            color: #555;
            line-height: 1.5;
        }

        .material-stock {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid #eee;
        }

        .stock-info {
            font-weight: bold;
        }

        .stock-available {
            color: #27ae60;
        }

        .stock-low {
            color: #e74c3c;
        }

        .material-actions {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }

        .btn {
            padding: 8px 16px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.9em;
            transition: background 0.3s;
        }

        .btn-primary {
            background: #3498db;
            color: white;
        }

        .btn-success {
            background: #27ae60;
            color: white;
        }

        .btn-warning {
            background: #f39c12;
            color: white;
        }

        .btn:hover {
            opacity: 0.9;
        }

        .categories {
            display: flex;
            gap: 10px;
            margin-bottom: 25px;
            flex-wrap: wrap;
        }

        .category-btn {
            padding: 10px 20px;
            border: 1px solid #3498db;
            background: white;
            color: #3498db;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .category-btn.active {
            background: #3498db;
            color: white;
        }

        @media (max-width: 768px) {
            .materials-grid {
                grid-template-columns: 1fr;
            }
            
            .search-bar {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="logo">–ö–û–í–®–ï–ô-–°–ï–†–í–ò–°</div>
            <div class="subtitle">–°–∏—Å—Ç–µ–º–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∑–∞—è–≤–∫–∞–º–∏ –Ω–∞ –º–∞—Ç–µ—Ä–∏–∞–ª—ã –¥–ª—è —Ä–µ–º–æ–Ω—Ç–∞ –∫–æ–≤—à–µ–π</div>
        </header>

        <nav>
            <ul class="nav-menu">
                <li><a href="index.html">–ì–ª–∞–≤–Ω–∞—è</a></li>
                <li><a href="requests.html">–ó–∞—è–≤–∫–∏</a></li>
                <li><a href="materials.html" class="active">–ú–∞—Ç–µ—Ä–∏–∞–ª—ã</a></li>
                <li><a href="reports.html">–û—Ç—á–µ—Ç—ã</a></li>
                <li><a href="employees.html">–°–æ—Ç—Ä—É–¥–Ω–∏–∫–∏</a></li>
                <li><a href="login.html">–í—Ö–æ–¥</a></li>
            </ul>
        </nav>

        <div class="page-header">
            <h1>–ö–∞—Ç–∞–ª–æ–≥ –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤</h1>
            <p>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –º–∞—Ç–µ—Ä–∏–∞–ª–∞–º–∏ –¥–ª—è —Ä–µ–º–æ–Ω—Ç–∞ –∫–æ–≤—à–µ–π</p>
        </div>

        <div class="content">
            <div class="search-bar">
                <input type="text" placeholder="üîç –ü–æ–∏—Å–∫ –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤...">
                <button>–ù–∞–π—Ç–∏</button>
                <button class="btn-success">+ –î–æ–±–∞–≤–∏—Ç—å –º–∞—Ç–µ—Ä–∏–∞–ª</button>
            </div>

            <div class="categories">
                <button class="category-btn active">–í—Å–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã</button>
                <button class="category-btn">–≠–ª–µ–∫—Ç—Ä–æ–¥—ã</button>
                <button class="category-btn">–°—Ç–∞–ª—å</button>
                <button class="category-btn">–ü—Ä–æ–≤–æ–ª–æ–∫–∞</button>
                <button class="category-btn">–ö–æ–º–ø–ª–µ–∫—Ç—É—é—â–∏–µ</button>
                <button class="category-btn">–†–∞—Å—Ö–æ–¥–Ω–∏–∫–∏</button>
            </div>

            <div class="materials-grid">
                <div class="material-card">
                    <div class="material-header">
                        <div>
                            <div class="material-name">–≠–ª–µ–∫—Ç—Ä–æ–¥—ã Hardex 600</div>
                            <div class="material-category">–≠–ª–µ–∫—Ç—Ä–æ–¥—ã</div>
                        </div>
                    </div>
                    <div class="material-details">
                        <p><strong>–û–ø–∏—Å–∞–Ω–∏–µ:</strong> –î–ª—è –Ω–∞–ø–ª–∞–≤–∫–∏ —Å –≤—ã—Å–æ–∫–æ–π –∏–∑–Ω–æ—Å–æ—Å—Ç–æ–π–∫–æ—Å—Ç—å—é</p>
                        <p><strong>–•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏:</strong> –î–∏–∞–º–µ—Ç—Ä 4.0 –º–º, –≤—Ä–µ–º—è –≥–µ–ª–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è 45 –º–∏–Ω</p>
                        <p><strong>–ï–¥–∏–Ω–∏—Ü–∞:</strong> –∫–≥</p>
                        <p><strong>–¶–µ–Ω–∞:</strong> 850 ‚ÇΩ/–∫–≥</p>
                    </div>
                    <div class="material-stock">
                        <div class="stock-info stock-available">‚úì –í –Ω–∞–ª–∏—á–∏–∏: 125 –∫–≥</div>
                    </div>
                    <div class="material-actions">
                        <button class="btn btn-primary">–ò–∑–º–µ–Ω–∏—Ç—å</button>
                        <button class="btn btn-warning">–ó–∞–∫–∞–∑–∞—Ç—å</button>
                    </div>
                </div>

                <div class="material-card">
                    <div class="material-header">
                        <div>
                            <div class="material-name">–°—Ç–∞–ª—å HARDOX 450</div>
                            <div class="material-category">–°—Ç–∞–ª—å</div>
                        </div>
                    </div>
                    <div class="material-details">
                        <p><strong>–û–ø–∏—Å–∞–Ω–∏–µ:</strong> –ò–∑–Ω–æ—Å–æ—Å—Ç–æ–π–∫–∞—è —Å—Ç–∞–ª—å –¥–ª—è —Å—Ç–µ–Ω–æ–∫ –∫–æ–≤—à–∞</p>
                        <p><strong>–•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏:</strong> –¢–æ–ª—â–∏–Ω–∞ 10 –º–º, —Ç–≤–µ—Ä–¥–æ—Å—Ç—å 450 HB</p>
                        <p><strong>–ï–¥–∏–Ω–∏—Ü–∞:</strong> –ª–∏—Å—Ç</p>
                        <p><strong>–¶–µ–Ω–∞:</strong> 12,500 ‚ÇΩ/–ª–∏—Å—Ç</p>
                    </div>
                    <div class="material-stock">
                        <div class="stock-info stock-low">‚ö† –ú–∞–ª–æ: 3 –ª–∏—Å—Ç–∞</div>
                    </div>
                    <div class="material-actions">
                        <button class="btn btn-primary">–ò–∑–º–µ–Ω–∏—Ç—å</button>
                        <button class="btn btn-warning">–ó–∞–∫–∞–∑–∞—Ç—å</button>
                    </div>
                </div>

                <div class="material-card">
                    <div class="material-header">
                        <div>
                            <div class="material-name">–ü—Ä–æ–≤–æ–ª–æ–∫–∞ –ü–ü-–ê–ù170</div>
                            <div class="material-category">–ü—Ä–æ–≤–æ–ª–æ–∫–∞</div>
                        </div>
                    </div>
                    <div class="material-details">
                        <p><strong>–û–ø–∏—Å–∞–Ω–∏–µ:</strong> –ü–æ—Ä–æ—à–∫–æ–≤–∞—è –ø—Ä–æ–≤–æ–ª–æ–∫–∞ –¥–ª—è –Ω–∞–ø–ª–∞–≤–∫–∏ –∑—É–±—å–µ–≤</p>
                        <p><strong>–•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏:</strong> –î–∏–∞–º–µ—Ç—Ä 2.8 –º–º, —Å–∫–æ—Ä–æ—Å—Ç—å –Ω–∞–ø–ª–∞–≤–∫–∏ 4.5 –∫–≥/—á</p>
                        <p><strong>–ï–¥–∏–Ω–∏—Ü–∞:</strong> –∫–≥</p>
                        <p><strong>–¶–µ–Ω–∞:</strong> 1,200 ‚ÇΩ/–∫–≥</p>
                    </div>
                    <div class="material-stock">
                        <div class="stock-info stock-available">‚úì –í –Ω–∞–ª–∏—á–∏–∏: 85 –∫–≥</div>
                    </div>
                    <div class="material-actions">
                        <button class="btn btn-primary">–ò–∑–º–µ–Ω–∏—Ç—å</button>
                        <button class="btn btn-warning">–ó–∞–∫–∞–∑–∞—Ç—å</button>
                    </div>
                </div>
            </div>
        </div>

        <footer>
            <p>¬© 2024 –°–∏—Å—Ç–µ–º–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∑–∞—è–≤–∫–∞–º–∏ "–ö–æ–≤—à–µ–π-–°–µ—Ä–≤–∏—Å". –í—Å–µ –ø—Ä–∞–≤–∞ –∑–∞—â–∏—â–µ–Ω—ã.</p>
        </footer>
    </div>

    <script src="app.js"></script>
    <script>
        let currentCategory = '–í—Å–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã';
        let currentSearch = '';

        document.addEventListener('DOMContentLoaded', function() {
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é
            const user = getCurrentUser();
            if (!user) {
                alert('–ù–µ–æ–±—Ö–æ–¥–∏–º–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ —ç—Ç–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ.');
                window.location.href = 'login.html';
                return;
            }
            
            if (!window.appData) {
                loadData().then(() => initMaterialsPage());
            } else {
                initMaterialsPage();
            }
        });

        function initMaterialsPage() {
            updateMaterialsList();
            
            // –ö–∞—Ç–µ–≥–æ—Ä–∏–∏
            document.querySelectorAll('.category-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    document.querySelectorAll('.category-btn').forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    currentCategory = this.textContent;
                    updateMaterialsList();
                });
            });

            // –ü–æ–∏—Å–∫
            const searchInput = document.querySelector('.search-bar input');
            const searchBtn = document.querySelector('.search-bar button');
            searchBtn.addEventListener('click', () => {
                currentSearch = searchInput.value;
                updateMaterialsList();
            });
            searchInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    currentSearch = searchInput.value;
                    updateMaterialsList();
                }
            });

            // –ö–Ω–æ–ø–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è (—Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –µ—Å—Ç—å –ø—Ä–∞–≤–∞)
            const addBtn = document.querySelector('.btn-success');
            if (addBtn && hasPermission('canAddMaterial')) {
                addBtn.addEventListener('click', () => showMaterialForm());
            } else if (addBtn) {
                addBtn.style.display = 'none';
            }
        }

        function updateMaterialsList() {
            const materials = searchMaterials(currentSearch, currentCategory);
            const grid = document.querySelector('.materials-grid');
            grid.innerHTML = '';
            
            materials.forEach(material => {
                const card = createMaterialCard(material);
                grid.appendChild(card);
            });
        }

        function createMaterialCard(material) {
            const card = document.createElement('div');
            card.className = 'material-card';
            const stockClass = material.stock > 10 ? 'stock-available' : 'stock-low';
            const stockText = material.stock > 10 ? `‚úì –í –Ω–∞–ª–∏—á–∏–∏: ${material.stock} ${material.unit}` : `‚ö† –ú–∞–ª–æ: ${material.stock} ${material.unit}`;
            
            card.innerHTML = `
                <div class="material-header">
                    <div>
                        <div class="material-name">${material.name}</div>
                        <div class="material-category">${material.category}</div>
                    </div>
                </div>
                <div class="material-details">
                    <p><strong>–û–ø–∏—Å–∞–Ω–∏–µ:</strong> ${material.description}</p>
                    <p><strong>–•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏:</strong> ${material.specifications}</p>
                    <p><strong>–ï–¥–∏–Ω–∏—Ü–∞:</strong> ${material.unit}</p>
                    <p><strong>–¶–µ–Ω–∞:</strong> ${material.price.toLocaleString()} ‚ÇΩ/${material.unit}</p>
                </div>
                <div class="material-stock">
                    <div class="stock-info ${stockClass}">${stockText}</div>
                </div>
                <div class="material-actions">
                    ${hasPermission('canEditMaterial') ? `<button class="btn btn-primary" onclick="editMaterial('${material.id}')">–ò–∑–º–µ–Ω–∏—Ç—å</button>` : ''}
                    ${hasPermission('canOrderMaterial') ? `<button class="btn btn-warning" onclick="orderMaterial('${material.id}')">–ó–∞–∫–∞–∑–∞—Ç—å</button>` : ''}
                </div>
            `;
            return card;
        }

        function showMaterialForm(material = null) {
            const isEdit = !!material;
            const content = `
                <form id="materialForm" style="display: flex; flex-direction: column; gap: 15px;">
                    <div><label style="display: block; margin-bottom: 5px; font-weight: bold;">–ù–∞–∑–≤–∞–Ω–∏–µ:</label>
                    <input type="text" id="mat-name" value="${material ? material.name : ''}" required style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px;"></div>
                    <div><label style="display: block; margin-bottom: 5px; font-weight: bold;">–ö–∞—Ç–µ–≥–æ—Ä–∏—è:</label>
                    <select id="mat-category" required style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px;">
                        <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é</option>
                        <option value="–≠–ª–µ–∫—Ç—Ä–æ–¥—ã" ${material && material.category === '–≠–ª–µ–∫—Ç—Ä–æ–¥—ã' ? 'selected' : ''}>–≠–ª–µ–∫—Ç—Ä–æ–¥—ã</option>
                        <option value="–°—Ç–∞–ª—å" ${material && material.category === '–°—Ç–∞–ª—å' ? 'selected' : ''}>–°—Ç–∞–ª—å</option>
                        <option value="–ü—Ä–æ–≤–æ–ª–æ–∫–∞" ${material && material.category === '–ü—Ä–æ–≤–æ–ª–æ–∫–∞' ? 'selected' : ''}>–ü—Ä–æ–≤–æ–ª–æ–∫–∞</option>
                        <option value="–ö–æ–º–ø–ª–µ–∫—Ç—É—é—â–∏–µ" ${material && material.category === '–ö–æ–º–ø–ª–µ–∫—Ç—É—é—â–∏–µ' ? 'selected' : ''}>–ö–æ–º–ø–ª–µ–∫—Ç—É—é—â–∏–µ</option>
                        <option value="–†–∞—Å—Ö–æ–¥–Ω–∏–∫–∏" ${material && material.category === '–†–∞—Å—Ö–æ–¥–Ω–∏–∫–∏' ? 'selected' : ''}>–†–∞—Å—Ö–æ–¥–Ω–∏–∫–∏</option>
                    </select></div>
                    <div><label style="display: block; margin-bottom: 5px; font-weight: bold;">–û–ø–∏—Å–∞–Ω–∏–µ:</label>
                    <textarea id="mat-description" required style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px; min-height: 60px;">${material ? material.description : ''}</textarea></div>
                    <div><label style="display: block; margin-bottom: 5px; font-weight: bold;">–•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏:</label>
                    <input type="text" id="mat-specs" value="${material ? material.specifications : ''}" required style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px;"></div>
                    <div><label style="display: block; margin-bottom: 5px; font-weight: bold;">–ï–¥–∏–Ω–∏—Ü–∞ –∏–∑–º–µ—Ä–µ–Ω–∏—è:</label>
                    <input type="text" id="mat-unit" value="${material ? material.unit : ''}" required style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px;"></div>
                    <div><label style="display: block; margin-bottom: 5px; font-weight: bold;">–¶–µ–Ω–∞ (‚ÇΩ):</label>
                    <input type="number" id="mat-price" value="${material ? material.price : ''}" required style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px;"></div>
                    <div><label style="display: block; margin-bottom: 5px; font-weight: bold;">–û—Å—Ç–∞—Ç–æ–∫ –Ω–∞ —Å–∫–ª–∞–¥–µ:</label>
                    <input type="number" id="mat-stock" value="${material ? material.stock : ''}" required style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px;"></div>
                </form>
            `;
            
            createModal(isEdit ? '–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –º–∞—Ç–µ—Ä–∏–∞–ª' : '–î–æ–±–∞–≤–∏—Ç—å –º–∞—Ç–µ—Ä–∏–∞–ª', content, [
                { text: '–û—Ç–º–µ–Ω–∞', onclick: 'closeModal()', class: 'btn-secondary' },
                { text: isEdit ? '–°–æ—Ö—Ä–∞–Ω–∏—Ç—å' : '–î–æ–±–∞–≤–∏—Ç—å', onclick: `saveMaterialForm('${material ? material.id : ''}')`, class: 'btn-success' }
            ]);
        }

        function saveMaterialForm(materialId) {
            if (materialId && !hasPermission('canEditMaterial')) {
                alert('–£ –≤–∞—Å –Ω–µ—Ç –ø—Ä–∞–≤ –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤.');
                return;
            }
            if (!materialId && !hasPermission('canAddMaterial')) {
                alert('–£ –≤–∞—Å –Ω–µ—Ç –ø—Ä–∞–≤ –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤.');
                return;
            }
            
            const materialData = {
                name: document.getElementById('mat-name').value,
                category: document.getElementById('mat-category').value,
                description: document.getElementById('mat-description').value,
                specifications: document.getElementById('mat-specs').value,
                unit: document.getElementById('mat-unit').value,
                price: parseFloat(document.getElementById('mat-price').value),
                stock: parseFloat(document.getElementById('mat-stock').value)
            };
            
            if (materialId) {
                const result = updateMaterial(materialId, materialData);
                if (result.success) {
                    alert('–ú–∞—Ç–µ—Ä–∏–∞–ª –æ–±–Ω–æ–≤–ª–µ–Ω!');
                    closeModal();
                    updateMaterialsList();
                }
            } else {
                const result = addMaterial(materialData);
                if (result.success) {
                    alert('–ú–∞—Ç–µ—Ä–∏–∞–ª –¥–æ–±–∞–≤–ª–µ–Ω!');
                    closeModal();
                    updateMaterialsList();
                }
            }
        }

        function editMaterial(id) {
            if (!hasPermission('canEditMaterial')) {
                alert('–£ –≤–∞—Å –Ω–µ—Ç –ø—Ä–∞–≤ –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤.');
                return;
            }
            const material = window.appData.materials.find(m => m.id === id);
            if (material) showMaterialForm(material);
        }

        // –§—É–Ω–∫—Ü–∏—è orderMaterial —Ç–µ–ø–µ—Ä—å –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ app.js
        // –ü—Ä–∏ –∑–∞–∫–∞–∑–µ –º–∞—Ç–µ—Ä–∏–∞–ª–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞–µ—Ç—Å—è –∑–∞—è–≤–∫–∞ –≤ —Ä–∞–∑–¥–µ–ª–µ "–ó–∞—è–≤–∫–∏"
    </script>
</body>
</html>